<!DOCTYPE html>
<html>
<head>
  <title>Scavenger Hunt Upload</title>
</head>
<body>
  <h2>Upload Task Photo</h2>
  <form id="uploadForm">
    <input type="text" id="teamName" placeholder="Team Name" required /><br />
    <input type="file" id="photoUpload" accept="image/*" required /><br />
    <button type="submit">Upload</button>
  </form>

  <p id="statusMsg"></p>

  <!-- Firebase SDKs via CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

  <script>
    // ✅ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAGotRFJR-p_NPFQNSKuhDJiyeQTpuFA3k",
      authDomain: "test-game-73230.firebaseapp.com",
      projectId: "test-game-73230",
      storageBucket: "test-game-73230.appspot.com",
      messagingSenderId: "849487663972",
      appId: "1:849487663972:web:a597020bec0c21e84ea071"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const db = firebase.firestore();

    const uploadForm = document.getElementById('uploadForm');
    const statusMsg = document.getElementById('statusMsg');

    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const teamName = document.getElementById('teamName').value;
      const file = document.getElementById('photoUpload').files[0];

      if (!file || !teamName) {
        statusMsg.innerText = "Please fill in all fields.";
        return;
      }

      const storageRef = storage.ref(`submissions/${teamName}_${Date.now()}_${file.name}`);

      try {
        await storageRef.put(file);
        const downloadURL = await storageRef.getDownloadURL();

        await db.collection('submissions').add({
          team: teamName,
          imageUrl: downloadURL,
          approved: false,
          submittedAt: new Date()
        });

        statusMsg.innerText = "✅ Uploaded successfully!";
        uploadForm.reset();
      } catch (err) {
        console.error(err);
        statusMsg.innerText = "❌ Upload failed.";
      }
    });
  </script>
</body>
</html>
